/* import { loginListenerEnvoyer } from "./login.js";
 */


//RECUPERATION DU DOM
const galleryElem = document.querySelector(".gallery");
const portfolioElem = document.querySelector("#portfolio");


//MODALE//
//RECUPERATION DU DOM --- MODALE
//DOM--BANNER
const editorMode = document.getElementById("editor");
/* const editorBanner = document.getElementByI("editor__banner");
 */
let bannerVisible = document.querySelector(".editor__banner");


const editorWindow = document.getElementById("editor__modal--window");
const editorBtnModal = document.getElementById("editor__modal--btn--modif");

//DOM--avant modale
const editModif = document.getElementById("editor__formodif");
const btnModifier = document.querySelector('.editor--btn--modifier');
const inconeModifier = document.querySelector(".editor_icone--modifier ")

//DOM--modale
const modale = document.querySelector(".editor__modal");
const windowModal = document.querySelector(".editor__modal--window");
const titleModal = document.querySelector(".editor__modal--title");

const modalebtn = document.querySelector(".editor__modal--btn--modif");




//FONCTION main
//RECUPERE LES PROJETS

function main() {
    getProjects().then((projects) => {
        afficherGallery(projects);
    });

    getCategories().then((categories) => {
        afficherCategories(categories)
    });

    if (window.localStorage.getItem('userToken') !== null) {
        enableAdmin()
    }
}


function enableAdmin() {
    // changer le lien de login en logout
    document.querySelector('#loginLink').innerHTML = "logout";
    /* Afficher le bandeau noir*/
    bannerVisible.classList.remove("editor__banner");
    bannerVisible.classList.add("editor__banner--visible");
    // Afficher le bouton modifier + icone
    btnModifier.classList.remove("editor--btn--modifier");
    btnModifier.classList.add("editor--btn--modifier--visible");
    inconeModifier.classList.remove("editor_icone--modifier");
    inconeModifier.classList.add("editor_icone--modifier--visible");


    // Activer les écouteurs sur le bouton et la modal
    btnModifier.addEventListener("click", showModal);
    function showModal() {
        modale.classList.remove("editor__modal");
        modale.classList.add("editor__modal--visible");
        windowModal.classList.remove("editor__modal--window");
        windowModal.classList.add("editor__modal--window--visible");
        titleModal.classList.remove("editor__modal--title");
        titleModal.classList.add("editor__modal--title--visible");
        modalebtn.classList.remove("editor__modal--btn--modif");
        modalebtn.classList.add("editor__modal--btn--modif--visible");
    };

    //supprimer les boutons catégories
    const filterContainer = document.querySelector("filter_container >.button");
    filterContainer.classList.remove("filter_container > .button");
    filterContainer.classList.add("filter_container > .button--hiden");
    console.log(filterContainer);

}


//RECUPERATION DES DONNEES DEPUIS SWAGGER
async function getProjects() {
    const reponse = await fetch('http://localhost:5678/api/works');
    const projects = await reponse.json();
    return projects;
}

function afficherGallery(projects, filter) {
    if (filter !== undefined && filter !== 'Tous') {
        projects = projects.filter((project) => project.category.name === filter)
    }

    galleryElem.innerHTML = '';

    for (let i = 0; i < projects.length; i++) {
        const figure = document.createElement("figure");
        galleryElem.appendChild(figure);

        const img = document.createElement("img");
        img.src = projects[i].imageUrl;
        figure.appendChild(img);

        const figCaption = document.createElement("figCaption");
        figCaption.textContent = projects[i].title;
        figure.appendChild(figCaption);
    }
}


//FILTRES//RECUPERATION DU SWAGGER POUR FILTRE

async function getCategories() {
    const reponse = await fetch('http://localhost:5678/api/categories');
    const categories = await reponse.json();
    return categories;
}

function afficherCategories(categories) {
    const filterContainer = document.createElement('div');
    filterContainer.classList.add('filter_container');
    portfolioElem.insertBefore(filterContainer, galleryElem);


    //VARIABLE POUR ELEMENT BOUTON TOUS
    const allElement = {
        'id': 0,
        'name': 'Tous'
    }

    // Unshift = ajouter l'élément au début du tableau/objet
    categories.unshift(allElement)

    categories.forEach((category, key) => {
        let filter = document.createElement('button');
        filter.classList.add('button');

        if (key === 0) {
            filter.classList.add('active');
        }
        filter.innerHTML = category.name

        filter.addEventListener('click', () => {

            // Supprime la classe active de tous les boutons
            const buttons = document.querySelectorAll('.button');
            buttons.forEach(button => {
                button.classList.remove('active');
            });

            // Ajoute la classe active au bouton actuellement cliqué
            filter.classList.add('active');


            filterGallery(category.name);

        });
        filterContainer.appendChild(filter);
    })
}

function filterGallery(filter) {
    getProjects().then((projects) => {
        afficherGallery(projects, filter);
    });
}

main();






